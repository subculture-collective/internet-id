# Dependabot configuration for automated dependency updates
# https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file

version: 2
updates:
  # Root package - Backend dependencies (Hardhat, TypeScript, Express, etc.)
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/Los_Angeles"
    open-pull-requests-limit: 10
    # Group related dependencies together
    groups:
      # Smart contract and blockchain tooling
      hardhat-and-ethers:
        patterns:
          - "hardhat*"
          - "ethers"
          - "@nomicfoundation/*"
          - "@openzeppelin/*"
          - "@typechain/*"
          - "typechain"
        update-types:
          - "minor"
          - "patch"
      # Testing dependencies
      testing-tools:
        patterns:
          - "chai"
          - "mocha"
          - "@types/chai"
          - "@types/mocha"
          - "sinon"
          - "@types/sinon"
          - "supertest"
          - "@types/supertest"
          - "nyc"
        update-types:
          - "minor"
          - "patch"
      # Database and ORM
      prisma:
        patterns:
          - "prisma"
          - "@prisma/*"
        update-types:
          - "minor"
          - "patch"
      # Security and monitoring
      security-tools:
        patterns:
          - "@sentry/*"
          - "helmet"
          - "express-rate-limit"
          - "rate-limit-redis"
        update-types:
          - "minor"
          - "patch"
      # Code quality tools
      linting-and-formatting:
        patterns:
          - "eslint*"
          - "prettier"
          - "@typescript-eslint/*"
        update-types:
          - "minor"
          - "patch"
      # TypeScript and types
      typescript:
        patterns:
          - "typescript"
          - "@types/*"
        update-types:
          - "minor"
          - "patch"
    # Require manual review for major updates
    labels:
      - "dependencies"
      - "automerge"
    commit-message:
      prefix: "chore(deps)"
      include: "scope"
    # Allow Dependabot to open security updates more frequently
    assignees:
      - "subculture-collective"

  # Web package - Next.js and React dependencies
  - package-ecosystem: "npm"
    directory: "/web"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/Los_Angeles"
    open-pull-requests-limit: 10
    groups:
      # React ecosystem
      react:
        patterns:
          - "react"
          - "react-dom"
          - "@types/react*"
        update-types:
          - "minor"
          - "patch"
      # Next.js and related
      nextjs:
        patterns:
          - "next"
          - "next-*"
          - "@next/*"
          - "eslint-config-next"
        update-types:
          - "minor"
          - "patch"
      # Authentication
      auth:
        patterns:
          - "next-auth"
          - "@auth/*"
        update-types:
          - "minor"
          - "patch"
      # Database (web client)
      prisma-web:
        patterns:
          - "prisma"
          - "@prisma/*"
          - "pg"
        update-types:
          - "minor"
          - "patch"
      # Testing (Playwright)
      playwright:
        patterns:
          - "playwright"
          - "@playwright/*"
        update-types:
          - "minor"
          - "patch"
      # Performance and monitoring
      performance:
        patterns:
          - "@lhci/*"
        update-types:
          - "minor"
          - "patch"
      # Code quality
      linting-web:
        patterns:
          - "eslint*"
          - "prettier"
        update-types:
          - "minor"
          - "patch"
    labels:
      - "dependencies"
      - "web"
      - "automerge"
    commit-message:
      prefix: "chore(deps/web)"
      include: "scope"
    assignees:
      - "subculture-collective"

  # CLI package
  - package-ecosystem: "npm"
    directory: "/cli"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/Los_Angeles"
    open-pull-requests-limit: 5
    groups:
      # CLI dependencies
      cli-tools:
        patterns:
          - "commander"
          - "inquirer"
          - "chalk"
          - "ora"
          - "@types/inquirer"
        update-types:
          - "minor"
          - "patch"
      # Shared dependencies
      cli-shared:
        patterns:
          - "axios"
          - "ethers"
          - "dotenv"
        update-types:
          - "minor"
          - "patch"
    labels:
      - "dependencies"
      - "cli"
      - "automerge"
    commit-message:
      prefix: "chore(deps/cli)"
      include: "scope"
    assignees:
      - "subculture-collective"

  # SDK package
  - package-ecosystem: "npm"
    directory: "/sdk/typescript"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/Los_Angeles"
    open-pull-requests-limit: 5
    groups:
      # SDK dependencies
      sdk:
        patterns:
          - "axios"
          - "typescript"
        update-types:
          - "minor"
          - "patch"
    labels:
      - "dependencies"
      - "sdk"
      - "automerge"
    commit-message:
      prefix: "chore(deps/sdk)"
      include: "scope"
    assignees:
      - "subculture-collective"

  # Security updates - check daily for all packages
  # This ensures critical security patches are addressed quickly
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "daily"
      time: "09:00"
      timezone: "America/Los_Angeles"
    open-pull-requests-limit: 5
    labels:
      - "security"
      - "dependencies"
      - "automerge"
    commit-message:
      prefix: "fix(security)"
      include: "scope"
    # Only security updates on this config
    allow:
      - dependency-type: "all"
    # High priority for security updates
    assignees:
      - "subculture-collective"
    reviewers:
      - "subculture-collective"

  - package-ecosystem: "npm"
    directory: "/web"
    schedule:
      interval: "daily"
      time: "09:00"
      timezone: "America/Los_Angeles"
    open-pull-requests-limit: 5
    labels:
      - "security"
      - "dependencies"
      - "web"
      - "automerge"
    commit-message:
      prefix: "fix(security/web)"
      include: "scope"
    allow:
      - dependency-type: "all"
    assignees:
      - "subculture-collective"
    reviewers:
      - "subculture-collective"

  # GitHub Actions dependencies
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/Los_Angeles"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "github-actions"
      - "automerge"
    commit-message:
      prefix: "chore(ci)"
      include: "scope"
    assignees:
      - "subculture-collective"

  # Docker base images
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/Los_Angeles"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "docker"
      - "automerge"
    commit-message:
      prefix: "chore(docker)"
      include: "scope"
    assignees:
      - "subculture-collective"
